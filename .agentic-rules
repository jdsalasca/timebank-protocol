# .agentic-rules

version: 1
project: timebank-protocol
mission: Enable a trustworthy, auditable time-credit protocol for mutual aid.

## 1) Priority Order (Always)

1. Ledger correctness
2. Security, fairness, and abuse prevention
3. Determinism and auditability
4. Testability and CI reliability
5. UX clarity for coordinators and members
6. Delivery speed

## 2) Scope Discipline

- One objective per PR.
- No unrelated refactors.
- Backend issue: avoid broad frontend redesign.
- Docs/backlog issue: avoid runtime behavior changes.
- If scope changes, stop and update issue + acceptance criteria before coding.

## 3) Source of Truth

- Canonical balances and trust logic live in backend (Java), never frontend.
- API/policy contract changes require OpenAPI + policy metadata updates in same PR.
- Rule changes require traceability and explicit assumptions.
- `docs/community/current-backlog.md` is weekly execution source.

## 4) Forbidden Commits

Do not commit:

- `apps/web-react/dist/*`
- `apps/web-react/test-results/*`
- screenshots or local audit artifacts (`*.png`, `*.jpg`) unless explicitly requested
- editor temp files, caches, local logs
- malformed config/docs (invalid JSON, broken markdown formatting)

## 5) Dependency Policy

- No dependency additions by default.
- Add dependencies only if issue requires and maintainer impact is documented.
- Any added dependency must include:
  - why native/project-local solution is insufficient
  - runtime vs dev-only classification
  - rollback/removal plan

## 6) Quality Gates Before Push

Required:

- `npm run quality:quick`
- `npm run backlog:current:check`
- `npm run agent:context:check`

If Java backend changed:

- `mvn -q test` in `apps/api-java`

## 7) Security and Fairness Rules

- Never leak secrets in logs/docs/examples.
- Keep threshold and anti-abuse decisions explicit and explainable.
- Preserve immutable audit trail for moderation and policy actions.
- Avoid hidden policy shifts; rule changes must be visible and documented.

## 8) Testing Rules

- Every bugfix must include a regression test.
- Every rule change must include deterministic ledger test coverage.
- Every behavior change must include test + docs update in same PR.
- Never bypass CI checks or test execution (`skipTests` prohibited in validation).

## 9) PR Evidence (Mandatory)

PR description must include:

- objective and story/issue ID
- files touched by layer (backend/frontend/contracts/docs)
- commands executed and outcomes
- fairness/abuse risk notes and rollback plan
- migration impact (`none` if not applicable)

## 10) Stop Conditions

Pause and request clarification when:

- fairness or policy impact is ambiguous
- task requires breaking change not approved
- security/privacy risk is uncertain
- contract/policy metadata changes are unclear

## 11) Definition of Excellent

A change is excellent only if it is:

- correct
- deterministic
- auditable
- fair
- tested
- documented
- scoped
- reversible
